---
### ALL PAGES ###
layout: master/admin/auth
permalink: /admin/delete/
sitemap:
  include: false

### REGULAR PAGES ###
meta:
  title: "Delete"
  description: "Delete your admin account."
  breadcrumb: "Delete"

### REGULAR PAGES ###
settings:
  manager-configuration: "
    {
      libraries: {
        cookieconsent: {
          enabled: false
        },
        tawk: {
          enabled: false
        },
        sentry: {
          enabled: false
        }
      },
      auth: {
        state: 'required',
        sends: {
          required: '/admin/signin/',
          prohibited: '/admin/dashboard/'
        }
      }
    }
  "
---
<div class="container">
  <div class="row justify-content-center">
    <div class="col-12 col-md-5 col-xl-4 my-5">

      {%- include /master/helpers/svg.html src=site.brand.logo-image-svg width="144" height="144" class="d-block mx-auto" -%}
      <!-- Heading -->
      <h1 class="display-4 text-center mb-3">
        Sad to see ya go!
      </h1>

      <!-- Subheading -->
      <p class="text-muted text-center mb-5">
        Are you sure you want to delete your account?
      </p>

      <!-- Submit -->
      <a id="delete-account-button" class="btn btn-lg btn-block btn-primary mb-3">
        Delete
      </a>

      <!-- Form -->
    </div>
  </div> <!-- / .row -->
</div> <!-- / .container -->

<script type="text/javascript">
  Manager.ready(function() {

    document.getElementById('delete-account-button').addEventListener('click', function () {
      var user = firebase.auth().currentUser;
      if (user && user.uid) {
        user.getIdToken(false)
          .then(function(token) {
            fetch('https://us-central1-' + Manager.properties.options.libraries.firebase_app.config.projectId + '.cloudfunctions.net/bm_deleteUser', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                authenticationToken: token,
              }),
            })
            .finally(function () {
              console.log('----HERE', user);
              // if (!user || !user.uid) {
              //   window.location.href = '{{ site.url }}/admin/signin/';
              // }
            });
            // Manager.ajax().request({
            //   url: 'https://us-central1-' + Manager.properties.options.libraries.firebase_app.config.projectId + '.cloudfunctions.net/bm_deleteUser',
            //   // url: 'http://localhost:5001/ultimate-jekyll/us-central1/bm_deleteUser',
            //   body: {
            //     authenticationToken: token,
            //   },
            //   timeout: 20000,
            // })
            // .always(function (response, status) {
            //   if (!user || !user.uid) {
            //     window.location.href = '{{ site.url }}/admin/signin/';
            //   }
            // });
          })
          .catch(function(error) {
            console.error(error);
          });
      } else {
        window.location.href = '{{ site.url }}/admin/signin/';
      }
    })

  });
</script>
